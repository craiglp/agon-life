Zilog eZ80 Macro Assembler Version 4.3 (19073001) RELISTED24-Apr-23     21:25:25     page:   1


PC     Object              I  Line    Source 
                           A     1    ;
                           A     2    ; Title:	Life - Main
                           A     3    ; Author:	Craig Patterson
                           A     4    ; Created:	04/02/2023
                           A     5    
                           A     6    ; Conway's Game of Life for Amstrad CPC
                           A     7    ; -------------------------------------
                           A     8    ;(Fast Version)
                           A     9    ;
                           A    10    ; Amstrad CPC version written by Brian Chiha
                           A    11    ; brian.chiha@gmail.com  -- Mar 2021
                           A    12    ;
                           A    13    ; Agon Light version written by Craig Patterson
                           A    14    ; craiglp@gmail.com -- Apr 2023
                           A    15    ;
                           A    16    ; Game of Life is a cellular automation simulat
                           A    17    ; of cells that surround it.  The basic cell ru
                           A    18    ;
                           A    19    ;    * Any live cell with two or three live nei
                           A    20    ;    * Any dead cell with three live neighbours
                           A    21    ;    * All other live cells die in the next gen
                           A    22    ;
                           A    23    
                           A    24    
                           A    25    
                           A    26    			.ASSUME	ADL = 0				
                           A    27    
                           B     0    			INCLUDE	"equs.inc"
                           B     1    ;
                           B     2    ; Title:	Memory Dump - Equs
                           B     3    ; Author:	Dean Belfield
                           B     4    ; Created:	15/11/2022
                           B     5    ; Last Updated:	15/11/2022
                           B     6    ;
                           B     7    ; Modinfo:
                           B     8    				
       0000FF00            B     9    RAM_Top:		EQU		0FF00h
       00000000            B    10    Stack_Top:		EQU		00000h	; Stack at top
                           B    11    	
                           B    12    ; For GPIO
                           B    13    ; PA not available on eZ80L92
                           B    14    ;
       00000096            B    15    PA_DR:			EQU		96h
       00000097            B    16    PA_DDR:			EQU		97h
       00000098            B    17    PA_ALT1:		EQU		98h
       00000099            B    18    PA_ALT2:		EQU		99h
       0000009A            B    19    PB_DR:          	EQU		9Ah
       0000009B            B    20    PB_DDR:        	 	EQU		9Bh
       0000009C            B    21    PB_ALT1:        	EQU		9Ch
       0000009D            B    22    PB_ALT2:        	EQU		9Dh
       0000009E            B    23    PC_DR:          	EQU		9Eh
       0000009F            B    24    PC_DDR:         	EQU		9Fh
       000000A0            B    25    PC_ALT1:        	EQU		A0h
       000000A1            B    26    PC_ALT2:        	EQU		A1h
       000000A2            B    27    PD_DR:          	EQU		A2h
       000000A3            B    28    PD_DDR:			EQU		A3h
       000000A4            B    29    PD_ALT1:		EQU		A4h
       000000A5            B    30    PD_ALT2:		EQU		A5h
                           B    31    	
       00000000            B    32    GPIOMODE_OUT:		EQU		0	; Output
       00000001            B    33    GPIOMODE_IN:		EQU		1	; Input
       00000002            B    34    GPIOMODE_DIO:		EQU		2	; Open Drain IO
       00000003            B    35    GPIOMODE_SIO:		EQU		3	; Open Source I
       00000004            B    36    GPIOMODE_INTD:		EQU		4	; Interrupt, Du
       00000005            B    37    GPIOMODE_ALTF:		EQU		5;	; Alt Function
       00000006            B    38    GPIOMODE_INTAL:		EQU		6	; Interrupt, Ac
       00000007            B    39    GPIOMODE_INTAH:		EQU		7	; Interrupt, Ac
       00000008            B    40    GPIOMODE_INTFE:		EQU		8	; Interrupt, Fa
       00000009            B    41    GPIOMODE_INTRE:		EQU		9	; Interrupt, Ri
                           B    42    	
                           B    43    ; For serial.asm
                           B    44    ; 
       016E3600            B    45    BASE_CLOCK		EQU	24000000	; It's actually
                           B    46    
       00000003            B    47    BAUD_500000		EQU	BASE_CLOCK / (16 * 500000)
       00000006            B    48    BAUD_250000		EQU	BASE_CLOCK / (16 * 250000)
       0000000C            B    49    BAUD_125000		EQU	BASE_CLOCK / (16 * 125000)
       0000004E            B    50    BAUD_19200		EQU	BASE_CLOCK / (16 * 19200)	
                           B    51    
                           B    52    ; For interrupts.asm
                           B    53    ;
                           B    54    
                           B    55    ;UARTs
                           B    56    ;
       00000018            B    57    UART0_IVECT		EQU		18h
       0000001A            B    58    UART1_IVECT		EQU		1Ah
                           B    59    
                           B    60    ;Ports
                           B    61    ;
       00000030            B    62    PB0_IVECT   		EQU   	30h	; AGON ITRP Int
       00000032            B    63    PB1_IVECT  	  	EQU  	32h	; AGON VBLANK Inter
       00000034            B    64    PB2_IVECT  	  	EQU   	34h
       00000036            B    65    PB3_IVECT  	  	EQU   	36h
       00000038            B    66    PB4_IVECT    		EQU   	38h
       0000003A            B    67    PB5_IVECT    		EQU   	3Ah
       0000003C            B    68    PB6_IVECT    		EQU   	3Ch
       0000003E            B    69    PB7_IVECT    		EQU   	3Eh
                           B    70                           
       00000040            B    71    PC0_IVECT    		EQU   	40h
       00000042            B    72    PC1_IVECT    		EQU   	42h
       00000044            B    73    PC2_IVECT    		EQU   	44h
       00000046            B    74    PC3_IVECT    		EQU   	46h
       00000048            B    75    PC4_IVECT    		EQU   	48h
       0000004A            B    76    PC5_IVECT    		EQU   	4Ah
       0000004C            B    77    PC6_IVECT    		EQU   	4Ch
       0000004E            B    78    PC7_IVECT    		EQU   	4Eh
                           B    79                           
       00000050            B    80    PD0_IVECT    		EQU   	50h
       00000052            B    81    PD1_IVECT    		EQU   	52h
       00000054            B    82    PD2_IVECT    		EQU   	54h
       00000056            B    83    PD3_IVECT    		EQU   	56h
       00000058            B    84    PD4_IVECT    		EQU   	58h
       0000005A            B    85    PD5_IVECT    		EQU   	5Ah
       0000005C            B    86    PD6_IVECT    		EQU   	5Ch
       0000005E            B    87    PD7_IVECT    		EQU   	5Eh
                           B    88    
                           B    89    ; Originally in main.asm
                           B    90    ;
       0000000D            B    91    CR:			EQU     0DH
       0000000A            B    92    LF:			EQU     0AH
       0000001B            B    93    ESC:		EQU     1BH
                           B     0    			INCLUDE "mos_api.inc"
                           B     1    ;
                           B     2    ; Title:	AGON MOS - API for user projects
                           B     3    ; Author:	Dean Belfield
                           B     4    ; Created:	03/08/2022
                           B     5    ; Last Updated:	22/03/2023
                           B     6    ;
                           B     7    ; Modinfo:
                           B     8    ; 05/08/2022:	Added mos_feof
                           B     9    ; 09/08/2022:	Added system variables: cursorX
                           B    10    ; 18/08/2022:	Added system variables: scrchar
                           B    11    ; 05/09/2022:	Added mos_ren, vdp_pflag_mode
                           B    12    ; 24/09/2022:	Added mos_getError, mos_mkdir
                           B    13    ; 13/10/2022:	Added mos_oscli
                           B    14    ; 23/02/2023:	Added more sysvars, fixed typo 
                           B    15    ; 04/03/2023:	Added sysvar_scrpixelIndex
                           B    16    ; 08/03/2023:	Renamed sysvar_keycode to sysva
                           B    17    ; 15/03/2023:	Added mos_copy, mos_getrtc, mos
                           B    18    ; 21/03/2023:	Added mos_setintvector, sysvars
                           B    19    ; 22/03/2023:	The VDP commands are now indexe
                           B    20    
                           B    21    ; VDP control (VDU 23, 0, n)
                           B    22    ;
       00000080            B    23    vdp_gp:			EQU 	80h
       00000081            B    24    vdp_keycode:		EQU 	81h
       00000082            B    25    vdp_cursor:		EQU	82h
       00000083            B    26    vdp_scrchar:		EQU	83h
       00000084            B    27    vdp_scrpixel:		EQU	84h
       00000085            B    28    vdp_audio:		EQU	85h
       00000086            B    29    vdp_mode:		EQU	86h
       00000087            B    30    vdp_rtc:		EQU	87h
       00000088            B    31    vdp_keystate:		EQU	88h
       000000C0            B    32    vdp_logicalcoords:	EQU	C0h
       000000FF            B    33    vdp_terminalmode:	EQU	FFh
                           B    34    
                           B    35    ; MOS high level functions
                           B    36    ;
       00000000            B    37    mos_getkey:		EQU	00h
       00000001            B    38    mos_load:		EQU	01h
       00000002            B    39    mos_save:		EQU	02h
       00000003            B    40    mos_cd:			EQU	03h
       00000004            B    41    mos_dir:		EQU	04h
       00000005            B    42    mos_del:		EQU	05h
       00000006            B    43    mos_ren:		EQU	06h
       00000007            B    44    mos_mkdir:		EQU	07h
       00000008            B    45    mos_sysvars:		EQU	08h
       00000009            B    46    mos_editline:		EQU	09h
       0000000A            B    47    mos_fopen:		EQU	0Ah
       0000000B            B    48    mos_fclose:		EQU	0Bh
       0000000C            B    49    mos_fgetc:		EQU	0Ch
       0000000D            B    50    mos_fputc:		EQU	0Dh
       0000000E            B    51    mos_feof:		EQU	0Eh
       0000000F            B    52    mos_getError:		EQU	0Fh
       00000010            B    53    mos_oscli:		EQU	10h
       00000011            B    54    mos_copy:		EQU	11h
       00000012            B    55    mos_getrtc:		EQU	12h
       00000013            B    56    mos_setrtc:		EQU	13h
       00000014            B    57    mos_setintvector:	EQU	14h
                           B    58    
                           B    59    ; FatFS file access functions
                           B    60    ;
       00000080            B    61    ffs_fopen:		EQU	80h
       00000081            B    62    ffs_fclose:		EQU	81h
       00000082            B    63    ffs_fread:		EQU	82h
       00000083            B    64    ffs_fwrite:		EQU	83h
       00000084            B    65    ffs_fseek:		EQU	84h
       00000085            B    66    ffs_ftruncate:		EQU	85h
       00000086            B    67    ffs_fsync:		EQU	86h
       00000087            B    68    ffs_fforward:		EQU	87h
       00000088            B    69    ffs_fexpand:		EQU	88h
       00000089            B    70    ffs_fgets:		EQU	89h
       0000008A            B    71    ffs_fputc:		EQU	8Ah
       0000008B            B    72    ffs_fputs:		EQU	8Bh
       0000008C            B    73    ffs_fprintf:		EQU	8Ch
       0000008D            B    74    ffs_ftell:		EQU	8Dh
       0000008E            B    75    ffs_feof:		EQU	8Eh
       0000008F            B    76    ffs_fsize:		EQU	8Fh
       00000090            B    77    ffs_ferror:		EQU	90h
                           B    78    
                           B    79    ; FatFS directory access functions
                           B    80    ;
       00000091            B    81    ffs_dopen:		EQU	91h
       00000092            B    82    ffs_dclose:		EQU	92h
       00000093            B    83    ffs_dread:		EQU	93h
       00000094            B    84    ffs_dfindfirst:		EQU	94h
       00000095            B    85    ffs_dfindnext:		EQU	95h
                           B    86    
                           B    87    ; FatFS file and directory management functions
                           B    88    ;
       00000096            B    89    ffs_stat:		EQU	96h
       00000097            B    90    ffs_unlink:		EQU	97h
       00000098            B    91    ffs_rename:		EQU	98h
       00000099            B    92    ffs_chmod:		EQU	99h
       0000009A            B    93    ffs_utime:		EQU	9Ah
       0000009B            B    94    ffs_mkdir:		EQU	9Bh
       0000009C            B    95    ffs_chdir:		EQU	9Ch
       0000009D            B    96    ffs_chdrive:		EQU	9Dh
       0000009E            B    97    ffs_getcwd:		EQU	9Eh
                           B    98    
                           B    99    ; FatFS volume management and system configurat
                           B   100    ;
       0000009F            B   101    ffs_mount:		EQU	9Fh
       000000A0            B   102    ffs_mkfs:		EQU	A0h
       000000A1            B   103    ffs_fdisk		EQU	A1h
       000000A2            B   104    ffs_getfree:		EQU	A2h
       000000A3            B   105    ffs_getlabel:		EQU	A3h
       000000A4            B   106    ffs_setlabel:		EQU	A4h
       000000A5            B   107    ffs_setcp:		EQU	A5h
                           B   108    	
                           B   109    ; File access modes
                           B   110    ;
       00000001            B   111    fa_read:		EQU	01h
       00000002            B   112    fa_write:		EQU	02h
       00000000            B   113    fa_open_existing:	EQU	00h
       00000004            B   114    fa_create_new:		EQU	04h
       00000008            B   115    fa_create_always:	EQU	08h
       00000010            B   116    fa_open_always:		EQU	10h
       00000030            B   117    fa_open_append:		EQU	30h
                           B   118    	
                           B   119    ; System variable indexes for api_sysvars
                           B   120    ; Index into _sysvars in globals.asm
                           B   121    ;
       00000000            B   122    sysvar_time:		EQU	00h	; 4: Clock timer in
       00000004            B   123    sysvar_vpd_pflags:	EQU	04h	; 1: Flags to indic
       00000005            B   124    sysvar_keyascii:	EQU	05h	; 1: ASCII keycode,
       00000006            B   125    sysvar_keymods:		EQU	06h	; 1: Keycode modifi
       00000007            B   126    sysvar_cursorX:		EQU	07h	; 1: Cursor X posit
       00000008            B   127    sysvar_cursorY:		EQU	08h	; 1: Cursor Y posit
       00000009            B   128    sysvar_scrchar:		EQU	09h	; 1: Character read
       0000000A            B   129    sysvar_scrpixel:	EQU	0Ah	; 3: Pixel data rea
       0000000D            B   130    sysvar_audioChannel:	EQU	0Dh	; 1: Audio chan
       0000000E            B   131    sysvar_audioSuccess:	EQU	0Eh	; 1: Audio chan
       0000000F            B   132    sysvar_scrWidth:	EQU	0Fh	; 2: Screen width i
       00000011            B   133    sysvar_scrHeight:	EQU	11h	; 2: Screen height 
       00000013            B   134    sysvar_scrCols:		EQU	13h	; 1: Screen columns
       00000014            B   135    sysvar_scrRows:		EQU	14h	; 1: Screen rows in
       00000015            B   136    sysvar_scrColours:	EQU	15h	; 1: Number of colo
       00000016            B   137    sysvar_scrpixelIndex:	EQU	16h	; 1: Index of p
       00000017            B   138    sysvar_vkeycode:	EQU	17h	; 1: Virtual key co
       00000018            B   139    sysvar_vkeydown		EQU	18h	; 1: Virtual key st
       00000019            B   140    sysvar_vkeycount:	EQU	19h	; 1: Incremented ev
       0000001A            B   141    sysvar_rtc:		EQU	1Ah	; 8: Real time clock da
       00000022            B   142    sysvar_keydelay:	EQU	22h	; 2: Keyboard repea
       00000024            B   143    sysvar_keyrate:		EQU	24h	; 2: Keyboard repea
       00000026            B   144    sysvar_keyled:		EQU	26h	; 1: Keyboard LED s
                           B   145    	
                           B   146    ; Flags for the VPD protocol
                           B   147    ;
       00000001            B   148    vdp_pflag_cursor:	EQU	00000001b
       00000002            B   149    vdp_pflag_scrchar:	EQU	00000010b
       00000004            B   150    vdp_pflag_point:	EQU	00000100b
       00000008            B   151    vdp_pflag_audio:	EQU	00001000b
       00000010            B   152    vdp_pflag_mode:		EQU	00010000b
       00000020            B   153    vdp_pflag_rtc:		EQU	00100000b
                           B   154    	
                           B   155    ;
                           B   156    ; Macro for calling the API
                           B   157    ; Parameters:
                           B   158    ; - function: One of the function numbers liste
                           B   159    ;
                           B   160    MOSCALL:		MACRO	function
                           B   161    			LD	A, function
                           B   162    			RST.LIS	08h
                           B   163    			ENDMACRO 	
                           A    30    			
                           A    31    			SEGMENT CODE
                           A    32    						
                           A    33    			XDEF	_main
                           A    34    			
       00000003            A    35    			SCRMODE		EQU		3h				
       00000019            A    36    			ROWS        EQU     25             
       00000028            A    37    			COLS        EQU     40             
                           A    38    			
       00000454            A    39    			TOT_CELLS	EQU		(ROWS+2)*(COLS+
                           A    40    
       00000156            A    41    			CURRBASE    EQU     _MATRIX_START  
       00000180            A    42    			CURRSTART   EQU     CURRBASE+COLS+2
                           A    43    
       000005AB            A    44    			NEXTBASE    EQU     CURRBASE+TOT_CE
       000005D5            A    45    			NEXTSTART   EQU     NEXTBASE+COLS+2
                           A    46    			
       0000002A            A    47                UPPER_LEFT		EQU		COLS+2		
       00000029            A    48                UPPER_MID		EQU		COLS+1		
       00000028            A    49                UPPER_RIGHT		EQU		COLS		
       00000001            A    50                MID_LEFT		EQU		1			
       00000001            A    51                MID_RIGHT		EQU		1			
       00000028            A    52                BOTTOM_LEFT		EQU		COLS		
       00000029            A    53                BOTTOM_MID		EQU		COLS+1		
       0000002A            A    54                BOTTOM_RIGHT	EQU		COLS+2		
                           A    55    
                           A    56    
                           A    57    ;To work out top/bottom cells, I place a zero r
                           A    58    ;handle left/right cells, I place one zero colu
                           A    59    ;I have one extra byte.
                           A    60    ;
                           A    61    ;If Cell is alive it will be set to 1, if it is
                           A    62    
                           A    63    ; Memory Map With Upper/Lower/Left/Right buffer
                           A    64    ; X = potential cell position, 0 = always zero
                           A    65    ;   000102030405060708090A0B0C0D0E0F10111213141
                           A    66    ;00  0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 
                           A    67    ;01  0 X X X X X X X X X X X X X X X X X X X X 
                           A    68    ;02  0 X X X X X X X X X X X X X X X X X X X X 
                           A    69    ;03  0 X X X X X X X X X X X X X X X X X X X X 
                           A    70    ;04  0 X X X X X X X X X X X X X X X X X X X X 
                           A    71    ;05  0 X X X X X X X X X X X X X X X X X X X X 
                           A    72    ;06  0 X X X X X X X X X X X X X X X X X X X X 
                           A    73    ;07  0 X X X X X X X X X X X X X X X X X X X X 
                           A    74    ;08  0 X X X X X X X X X X X X X X X X X X X X 
                           A    75    ;09  0 X X X X X X X X X X X X X X X X X X X X 
                           A    76    ;0A  0 X X X X X X X X X X X X X X X X X X X X 
                           A    77    ;0B  0 X X X X X X X X X X X X X X X X X X X X 
                           A    78    ;0C  0 X X X X X X X X X X X X X X X X X X X X 
                           A    79    ;0D  0 X X X X X X X X X X X X X X X X X X X X 
                           A    80    ;0E  0 X X X X X X X X X X X X X X X X X X X X 
                           A    81    ;0F  0 X X X X X X X X X X X X X X X X X X X X 
                           A    82    ;10  0 X X X X X X X X X X X X X X X X X X X X 
                           A    83    ;11  0 X X X X X X X X X X X X X X X X X X X X 
                           A    84    ;12  0 X X X X X X X X X X X X X X X X X X X X 
                           A    85    ;13  0 X X X X X X X X X X X X X X X X X X X X 
                           A    86    ;14  0 X X X X X X X X X X X X X X X X X X X X 
                           A    87    ;15  0 X X X X X X X X X X X X X X X X X X X X 
                           A    88    ;16  0 X X X X X X X X X X X X X X X X X X X X 
                           A    89    ;17  0 X X X X X X X X X X X X X X X X X X X X 
                           A    90    ;18  0 X X X X X X X X X X X X X X X X X X X X 
                           A    91    ;19  0 X X X X X X X X X X X X X X X X X X X X 
                           A    92    ;1A  0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 
                           A    93    ;1B  0  <= needed for last bottom right check
                           A    94    
                           A    95    
                           A    96    
000142                     A    97    _main:		
                           A    98    			;Set screen mode
000142 3E16                A    99    			LD		A, 22		;VDU 22
000144 5BD7                A   100    			RST.LIL	10h
000146 3E03                A   101    			LD		A, SCRMODE	;Screen mode
000148 5BD7                A   102    			RST.LIL	10h	
                           A   103    			
                           A   104    			;Disable text cursor
00014A 3E17                A   105    			LD		A, 23		;VDU 23
00014C 5BD7                A   106    			RST.LIL	10h
00014E 3E01                A   107    			LD		A, 1
000150 5BD7                A   108    			RST.LIL	10h			
000152 3E00                A   109    			LD		A, 0
000154 5BD7                A   110    			RST.LIL	10h			
                           A   111    			
000156 21 8E 02            A   112    			LD		HL, s_CELL_CHAR
000159 CD 4D 02            A   113    			CALL	Print_String
                           A   114    
00015C                     A   115    START:
00015C 21 98 02            A   116                LD      HL,CURRBASE     ;Clear Curr
00015F 11 99 02            A   117                LD      DE,CURRBASE+1 
000162 AF                  A   118                XOR     A               ;Set to Zer
000163 77                  A   119                LD      (HL),A 
000164 015404              A   120                LD      BC,TOT_CELLS    ;Cells to b
000167 EDB0                A   121                LDIR                    ;Do the Cop
000169 21 AB 05            A   122                LD      HL,NEXTBASE     ;Clear Next
00016C 11 AC 05            A   123                LD      DE,NEXTBASE+1 
00016F AF                  A   124                XOR     A               ;Set to Zer
000170 77                  A   125                LD      (HL),A 
000171 015404              A   126                LD      BC,TOT_CELLS    ;1108 cells
000174 EDB0                A   127                LDIR                    ;Do the Cop
                           A   128    			
000176                     A   129    NEWCELLS:            
000176 CD F3 01            A   130                CALL    LOAD_RANDOM		;Initialize
                           A   131    
000179                     A   132    LIFE:
000179 CD 1B 02            A   133    			CALL	PRINT_CELLS
                           A   134    			;CALL    DISPLAY_CELLS	;Fill scree
                           A   135    			
00017C CD A4 01            A   136                CALL    CONWAY			;Do Conway 
                           A   137    			
                           A   138    			;Loop until key pressed			
                           A   139    			MOSCALL	mos_getkey
000183 B7                  A   140    			OR		A 		
000184 28 F3               A   141    			JR		Z, LIFE
                           A   142    			
000186 FE1B                A   143                CP      ESC				;Escape pre
000188 20 EF               A   144                JR      NZ,LIFE			;Key presse
                           A   145    
00018A 21 7C 02            A   146    			LD		HL, s_LIFE_END	;Escape pre
00018D 010000              A   147    			LD		BC, 0
000190 3E00                A   148    			LD		A, 0
000192 49DF                A   149    			RST.LIS	18h
                           A   150    											
000194                     A   151    	FINI:	
                           A   152    			;Enable text cursor
000194 3E17                A   153    			LD		A, 23		;VDU 23
000196 5BD7                A   154    			RST.LIL	10h
000198 3E01                A   155    			LD		A, 1
00019A 5BD7                A   156    			RST.LIL	10h			
00019C 3E01                A   157    			LD		A, 1
00019E 5BD7                A   158    			RST.LIL	10h			
                           A   159    
0001A0 210000              A   160    			LD		HL, 0			;Return, Er
0001A3 C9                  A   161    			RET
                           A   162    
                           A   163                ;Update the matrix with Conway Rule
                           A   164    			;The basic cell rules are:
                           A   165    			;
                           A   166    			;    * Any live cell with two or th
                           A   167    			;    * Any dead cell with three liv
                           A   168    			;    * All other live cells die in 
0001A4                     A   169    CONWAY:
0001A4 DD21 80 01          A   170                LD      IX,CURRSTART
0001A8 21 D5 05            A   171                LD      HL,NEXTSTART
0001AB 0619                A   172                LD      B,ROWS
0001AD                     A   173    	NEWROW:              
0001AD C5                  A   174                PUSH    BC ;Save Registers
0001AE 0628                A   175                LD      B,COLS ;40 Columns
0001B0                     A   176    	NEWCOL:              
                           A   177                ;Check the current cell and update 
                           A   178                ;make checking easier
0001B0 DD7ED6              A   179                LD      A,(IX-UPPER_LEFT)          
0001B3 DD86D7              A   180                ADD     A,(IX-UPPER_MID)           
0001B6 DD86D8              A   181                ADD     A,(IX-UPPER_RIGHT)         
0001B9 DD86FF              A   182                ADD     A,(IX-MID_LEFT)            
0001BC DD8601              A   183                ADD     A,(IX+MID_RIGHT)           
0001BF DD8628              A   184                ADD     A,(IX+BOTTOM_LEFT)         
0001C2 DD8629              A   185                ADD     A,(IX+BOTTOM_MID)          
0001C5 DD862A              A   186                ADD     A,(IX+BOTTOM_RIGHT)        
                           A   187    			
0001C8                     A   188    		EVALUATE:       
                           A   189                ;Evaluate surrounding cell count to
                           A   190                ;This is the rules being applied fo
0001C8 1601                A   191                LD      D,01h                ;Alive
0001CA FE03                A   192                CP      03h                  ;Check
0001CC 28 0C               A   193                JR      Z,STOREC             ;Save 
0001CE 1600                A   194                LD      D,00h                ;Dead
0001D0 FE02                A   195                CP      02h                  ;Check
0001D2 20 06               A   196                JR      NZ,STOREC            ;Save 
0001D4 DD7E00              A   197                LD      A,(IX+0)             ;Curre
0001D7 E601                A   198                AND     01h                  ;Keep 
0001D9 57                  A   199                LD      D,A                  ;Load 
                           A   200    			
0001DA                     A   201    		STOREC:              
                           A   202                ;Save the new cell to the Next Cell
0001DA 7A                  A   203                LD      A,D                  ;D sto
0001DB 77                  A   204                LD      (HL),A               ;Updat
0001DC 23                  A   205                INC     HL                   ;Move 
0001DD DD23                A   206                INC     IX                   ;Move 
0001DF 10 CF               A   207                DJNZ    NEWCOL               ;Repea
                           A   208    
0001E1 23                  A   209                INC     HL                   ;Skip 
0001E2 DD23                A   210                INC     IX                   ;Skip 
0001E4 C1                  A   211                POP     BC 
0001E5 10 C6               A   212                DJNZ    NEWROW               ;Repea
                           A   213    
                           A   214                ;Copy next matrix to current
0001E7 21 D5 05            A   215                LD      HL,NEXTSTART 
0001EA 11 80 01            A   216                LD      DE,CURRSTART 
0001ED 010004              A   217                LD      BC,0400h             ;1024 
0001F0 EDB0                A   218                LDIR                         ;Do th
                           A   219    
0001F2 C9                  A   220                RET                          ;Exit
                           A   221    			
                           A   222    
                           A   223    			;Load Random cells in memory.  This
                           A   224                ;an psuedo random routine.  If that
                           A   225                ;cell to Alive.
0001F3                     A   226    LOAD_RANDOM:
0001F3 21 80 01            A   227    			LD      HL,CURRSTART 
0001F6 0619                A   228                LD      B,ROWS 
0001F8                     A   229    	COL:									;Co
0001F8 C5                  A   230                PUSH    BC 
0001F9 0628                A   231                LD      B,COLS 
0001FB                     A   232    	ROW:								;Rows
0001FB CD 69 02            A   233                CALL    RAND_8				;Call r
0001FE 3E01                A   234                LD      A,01h				;Defaul
000200 38 01               A   235                JR      C,STORECELL 
000202 AF                  A   236                XOR     A					;Set to
000203                     A   237    	STORECELL:           
000203 77                  A   238                LD      (HL),A				;Store 
000204 23                  A   239                INC     HL 
000205 10 F4               A   240                DJNZ    ROW 
000207 23                  A   241                INC     HL					;Skip l
000208 C1                  A   242                POP     BC 
000209 10 ED               A   243                DJNZ    COL 
00020B C9                  A   244                RET							;Exit
                           A   245    
                           A   246                ;Random boolean value.  Carry flag 
00020C                     A   247    	RAND:                
00020C C5                  A   248                PUSH    BC 
00020D ED5F                A   249                LD      A,R                  ;Rando
00020F 47                  A   250                LD      B,A 
000210 0F                  A   251                RRCA                         ;Multi
000211 0F                  A   252                RRCA     
000212 0F                  A   253                RRCA     
000213 EE1F                A   254                XOR     1Fh 
000215 80                  A   255                ADD     A,B 
000216 DEFF                A   256                SBC     A,FFh 
000218 C1                  A   257                POP     BC 
000219 0F                  A   258                RRCA                         ;Check
00021A C9                  A   259                RET      
                           A   260    
00021B                     A   261    PRINT_CELLS:
00021B 3E0C                A   262    			LD		A,12				;Clear 
00021D 5BD7                A   263    			RST.LIL	10h
                           A   264    			
00021F DD21 80 01          A   265    			LD      IX,CURRSTART 
000223 0619                A   266    			LD		B,ROWS
000225                     A   267    	col_loop:
000225 C5                  A   268    			PUSH	BC
000226 0628                A   269    			LD		B,COLS
000228                     A   270    	row_loop:
000228 DD7E00              A   271    			LD		A,(IX)
00022B CD 40 02            A   272    			CALL	Print_Cell
                           A   273    			
00022E DD23                A   274    			INC		IX
000230 10 F6               A   275    			DJNZ	row_loop
                           A   276    
                           A   277    			;Print CR/LF after each row
000232 57                  A   278    			LD		D, A
000233 3E0D                A   279    			LD		A, 0Dh
000235 49D7                A   280    			RST.LIS	10h
000237 3E0A                A   281    			LD		A, 0Ah
000239 49D7                A   282    			RST.LIS	10h
00023B 7A                  A   283    			LD		A, D
                           A   284    			
00023C C1                  A   285    			POP		BC
00023D 10 E6               A   286    			DJNZ	col_loop
00023F C9                  A   287    			RET							;Exit
                           A   288    
000240                     A   289    Print_Cell:
000240 4F                  A   290    			LD C,A
000241 FE01                A   291    			CP 01h
000243 3E20                A   292    			LD A, 20h
000245 20 02               A   293    			JR NZ,PZ
000247 3E82                A   294    			LD A, 130
000249 49D7                A   295    	PZ:		RST.LIS 10h
00024B 79                  A   296    			LD A,C
00024C C9                  A   297    			RET
                           A   298    			
00024D                     A   299    Print_String:
00024D 010000              A   300    			LD		BC, 0
000250 3E00                A   301    			LD		A, 0
000252 49DF                A   302    			RST.LIS	18h
000254 C9                  A   303    			RET
                           A   304    
                           A   305    ; Print an 8-bit HEX number
                           A   306    ; A: Number to print
000255                     A   307    Print_Hex8:
000255 4F                  A   308    			LD		C,A
000256 1F                  A   309    			RRA 
000257 1F                  A   310    			RRA 
000258 1F                  A   311    			RRA 
000259 1F                  A   312    			RRA 
00025A CD 5E 02            A   313    			CALL	$F 
00025D 79                  A   314    			LD		A,C 
00025E E60F                A   315    $$:			AND		0Fh
000260 C690                A   316    			ADD		A,90h
000262 27                  A   317    			DAA
000263 CE40                A   318    			ADC		A,40h
000265 27                  A   319    			DAA
000266 49D7                A   320    			RST.LIS	10h
000268 C9                  A   321    			RET
                           A   322    			
                           A   323    ; returns pseudo random 8 bit number in A. Only
                           A   324    ; (r_seed) is the byte from which the number is
                           A   325    ; initialised to a non zero value or this funct
                           A   326    ; zero. Also r_seed must be in RAM, you can see
000269                     A   327    RAND_8:
000269 3A 7B 02            A   328    			LD	A,(r_seed)	; get seed
00026C E6B8                A   329    			AND	#B8h		; mask non feedback
00026E 37                  A   330    			SCF				; set carry
00026F E2 73 02            A   331    			JP	PO,no_clr	; skip clear if odd
000272 3F                  A   332    			CCF				; complement carry 
000273                     A   333    	no_clr:
000273 3A 7B 02            A   334    			LD	A,(r_seed)	; get seed back
000276 17                  A   335    			RLA				; rotate carry into
000277 32 7B 02            A   336    			LD	(r_seed),A	; save back for nex
00027A C9                  A   337    			RET				; done
00027B                     A   338    	r_seed:
00027B FE                  A   339    			DB	254			; prng seed byte (m
                           A   340    	
                           A   341    
                           A   342    
                           A   343    ; Text strings
                           A   344    ;
00027C 0A0D4669 6E697368   A   345    s_LIFE_END:	DB 	"\n\rFinished\n\r", 0
000284 65640A0D 00 
000289 0A0D00              A   346    s_cr_lf:	DB	"\n\r", 0
00028C 0D00                A   347    s_cr:		DB	"\r", 0
                           A   348    
00028E 17823C7E FFFFFFFF   A   349    s_CELL_CHAR DB 23,130,3Ch,7Eh,FFh,FFh,FFh,FFh,7
000296 7E3C 
                           A   350    
000298                     A   351    _MATRIX_START:
                           A   352    	
                           A   353    ; RAM
                           A   354    ; 
                           A   355    			DEFINE	LORAM, SPACE = ROM
                           A   356    			SEGMENT LORAM
                           A   357    			


Errors: 0
Warnings: 0
Lines Assembled: 617
